{"remainingRequest":"/Users/zkk/code/program/admin-system/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zkk/code/program/admin-system/src/components/uploadExcel/uploadExcel.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/zkk/code/program/admin-system/src/components/uploadExcel/uploadExcel.vue","mtime":1593950873047},{"path":"/Users/zkk/code/program/admin-system/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zkk/code/program/admin-system/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/zkk/code/program/admin-system/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zkk/code/program/admin-system/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBYTFNYIGZyb20gJ3hsc3gnCgpleHBvcnQgZGVmYXVsdCB7CiAgICBwcm9wczogewogICAgICAgIGJlZm9yZVVwbG9hZDogRnVuY3Rpb24sIC8vIGVzbGludC1kaXNhYmxlLWxpbmUKICAgICAgICBvblN1Y2Nlc3M6IEZ1bmN0aW9uLy8gZXNsaW50LWRpc2FibGUtbGluZQogICAgfSwKICAgIGRhdGEoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgbG9hZGluZzogZmFsc2UsCiAgICAgICAgICAgIGV4Y2VsRGF0YTogewogICAgICAgICAgICAgICAgaGVhZGVyOiBudWxsLAogICAgICAgICAgICAgICAgcmVzdWx0czogbnVsbAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSwKICAgIG1ldGhvZHM6IHsKICAgICAgICBnZW5lcmF0ZURhdGEoeyBoZWFkZXIsIHJlc3VsdHMgfSkgewogICAgICAgICAgICB0aGlzLmV4Y2VsRGF0YS5oZWFkZXIgPSBoZWFkZXIKICAgICAgICAgICAgdGhpcy5leGNlbERhdGEucmVzdWx0cyA9IHJlc3VsdHMKICAgICAgICAgICAgdGhpcy5vblN1Y2Nlc3MgJiYgdGhpcy5vblN1Y2Nlc3ModGhpcy5leGNlbERhdGEpCiAgICAgICAgfSwKICAgICAgICBoYW5kbGVEcm9wKGUpIHsKICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKQogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCkKICAgICAgICAgICAgaWYgKHRoaXMubG9hZGluZykgcmV0dXJuCiAgICAgICAgICAgIGNvbnN0IGZpbGVzID0gZS5kYXRhVHJhbnNmZXIuZmlsZXMKICAgICAgICAgICAgaWYgKGZpbGVzLmxlbmd0aCAhPT0gMSkgewogICAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcignT25seSBzdXBwb3J0IHVwbG9hZGluZyBvbmUgZmlsZSEnKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgcmF3RmlsZSA9IGZpbGVzWzBdIC8vIG9ubHkgdXNlIGZpbGVzWzBdCgogICAgICAgICAgICBpZiAoIXRoaXMuaXNFeGNlbChyYXdGaWxlKSkgewogICAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcignT25seSBzdXBwb3J0cyB1cGxvYWQgLnhsc3gsIC54bHMsIC5jc3Ygc3VmZml4IGZpbGVzJykKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMudXBsb2FkKHJhd0ZpbGUpCiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCkKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpCiAgICAgICAgfSwKICAgICAgICBoYW5kbGVEcmFnb3ZlcihlKSB7CiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCkKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpCiAgICAgICAgICAgIGUuZGF0YVRyYW5zZmVyLmRyb3BFZmZlY3QgPSAnY29weScKICAgICAgICB9LAogICAgICAgIGhhbmRsZVVwbG9hZCgpIHsKICAgICAgICAgICAgdGhpcy4kcmVmc1snZXhjZWwtdXBsb2FkLWlucHV0J10uY2xpY2soKQogICAgICAgIH0sCiAgICAgICAgaGFuZGxlQ2xpY2soZSkgewogICAgICAgICAgICBjb25zdCBmaWxlcyA9IGUudGFyZ2V0LmZpbGVzCiAgICAgICAgICAgIGNvbnN0IHJhd0ZpbGUgPSBmaWxlc1swXSAvLyBvbmx5IHVzZSBmaWxlc1swXQogICAgICAgICAgICBpZiAoIXJhd0ZpbGUpIHJldHVybgogICAgICAgICAgICB0aGlzLnVwbG9hZChyYXdGaWxlKQogICAgICAgIH0sCiAgICAgICAgdXBsb2FkKHJhd0ZpbGUpIHsKICAgICAgICAgICAgdGhpcy4kcmVmc1snZXhjZWwtdXBsb2FkLWlucHV0J10udmFsdWUgPSBudWxsIC8vIGZpeCBjYW4ndCBzZWxlY3QgdGhlIHNhbWUgZXhjZWwKCiAgICAgICAgICAgIGlmICghdGhpcy5iZWZvcmVVcGxvYWQpIHsKICAgICAgICAgICAgICAgIHRoaXMucmVhZGVyRGF0YShyYXdGaWxlKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgYmVmb3JlID0gdGhpcy5iZWZvcmVVcGxvYWQocmF3RmlsZSkKICAgICAgICAgICAgaWYgKGJlZm9yZSkgewogICAgICAgICAgICAgICAgdGhpcy5yZWFkZXJEYXRhKHJhd0ZpbGUpCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHJlYWRlckRhdGEocmF3RmlsZSkgewogICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlCiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpCiAgICAgICAgICAgICAgICByZWFkZXIub25sb2FkID0gZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IGUudGFyZ2V0LnJlc3VsdAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdvcmtib29rID0gWExTWC5yZWFkKGRhdGEsIHsgdHlwZTogJ2FycmF5JyB9KQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpcnN0U2hlZXROYW1lID0gd29ya2Jvb2suU2hlZXROYW1lc1swXQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdvcmtzaGVldCA9IHdvcmtib29rLlNoZWV0c1tmaXJzdFNoZWV0TmFtZV0KICAgICAgICAgICAgICAgICAgICBjb25zdCBoZWFkZXIgPSB0aGlzLmdldEhlYWRlclJvdyh3b3Jrc2hlZXQpCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IFhMU1gudXRpbHMuc2hlZXRfdG9fanNvbih3b3Jrc2hlZXQpCiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZURhdGEoeyBoZWFkZXIsIHJlc3VsdHMgfSkKICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKHJhd0ZpbGUpCiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBnZXRIZWFkZXJSb3coc2hlZXQpIHsKICAgICAgICAgICAgY29uc3QgaGVhZGVycyA9IFtdCiAgICAgICAgICAgIGNvbnN0IHJhbmdlID0gWExTWC51dGlscy5kZWNvZGVfcmFuZ2Uoc2hlZXRbJyFyZWYnXSkKICAgICAgICAgICAgbGV0IEMKICAgICAgICAgICAgY29uc3QgUiA9IHJhbmdlLnMucgogICAgICAgICAgICAvKiBzdGFydCBpbiB0aGUgZmlyc3Qgcm93ICovCiAgICAgICAgICAgIGZvciAoQyA9IHJhbmdlLnMuYzsgQyA8PSByYW5nZS5lLmM7ICsrQykgeyAvKiB3YWxrIGV2ZXJ5IGNvbHVtbiBpbiB0aGUgcmFuZ2UgKi8KICAgICAgICAgICAgICAgIGNvbnN0IGNlbGwgPSBzaGVldFtYTFNYLnV0aWxzLmVuY29kZV9jZWxsKHsgYzogQywgcjogUiB9KV0KICAgICAgICAgICAgICAgIC8qIGZpbmQgdGhlIGNlbGwgaW4gdGhlIGZpcnN0IHJvdyAqLwogICAgICAgICAgICAgICAgbGV0IGhkciA9ICdVTktOT1dOICcgKyBDIC8vIDwtLSByZXBsYWNlIHdpdGggeW91ciBkZXNpcmVkIGRlZmF1bHQKICAgICAgICAgICAgICAgIGlmIChjZWxsICYmIGNlbGwudCkgaGRyID0gWExTWC51dGlscy5mb3JtYXRfY2VsbChjZWxsKQogICAgICAgICAgICAgICAgaGVhZGVycy5wdXNoKGhkcikKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gaGVhZGVycwogICAgICAgIH0sCiAgICAgICAgaXNFeGNlbChmaWxlKSB7CiAgICAgICAgICAgIHJldHVybiAvXC4oeGxzeHx4bHN8Y3N2KSQvLnRlc3QoZmlsZS5uYW1lKQogICAgICAgIH0KICAgIH0KfQo="},{"version":3,"sources":["uploadExcel.vue"],"names":[],"mappings":";;;;;;;;;;;;;AAaA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"uploadExcel.vue","sourceRoot":"src/components/uploadExcel","sourcesContent":["<template>\n    <div>\n        <input ref=\"excel-upload-input\" class=\"excel-upload-input\" type=\"file\" accept=\".xlsx, .xls\" @change=\"handleClick\">\n        <div class=\"drop\" @drop=\"handleDrop\" @dragover=\"handleDragover\" @dragenter=\"handleDragover\">\n            Drop excel file here or\n            <el-button :loading=\"loading\" style=\"margin-left:16px;font-size: 18px\" size=\"large\" type=\"primary\" @click=\"handleUpload\">\n                Browse\n            </el-button>\n        </div>\n    </div>\n</template>\n\n<script>\n    import XLSX from 'xlsx'\n\n    export default {\n        props: {\n            beforeUpload: Function, // eslint-disable-line\n            onSuccess: Function// eslint-disable-line\n        },\n        data() {\n            return {\n                loading: false,\n                excelData: {\n                    header: null,\n                    results: null\n                }\n            }\n        },\n        methods: {\n            generateData({ header, results }) {\n                this.excelData.header = header\n                this.excelData.results = results\n                this.onSuccess && this.onSuccess(this.excelData)\n            },\n            handleDrop(e) {\n                e.stopPropagation()\n                e.preventDefault()\n                if (this.loading) return\n                const files = e.dataTransfer.files\n                if (files.length !== 1) {\n                    this.$message.error('Only support uploading one file!')\n                    return\n                }\n                const rawFile = files[0] // only use files[0]\n\n                if (!this.isExcel(rawFile)) {\n                    this.$message.error('Only supports upload .xlsx, .xls, .csv suffix files')\n                    return false\n                }\n                this.upload(rawFile)\n                e.stopPropagation()\n                e.preventDefault()\n            },\n            handleDragover(e) {\n                e.stopPropagation()\n                e.preventDefault()\n                e.dataTransfer.dropEffect = 'copy'\n            },\n            handleUpload() {\n                this.$refs['excel-upload-input'].click()\n            },\n            handleClick(e) {\n                const files = e.target.files\n                const rawFile = files[0] // only use files[0]\n                if (!rawFile) return\n                this.upload(rawFile)\n            },\n            upload(rawFile) {\n                this.$refs['excel-upload-input'].value = null // fix can't select the same excel\n\n                if (!this.beforeUpload) {\n                    this.readerData(rawFile)\n                    return\n                }\n                const before = this.beforeUpload(rawFile)\n                if (before) {\n                    this.readerData(rawFile)\n                }\n            },\n            readerData(rawFile) {\n                this.loading = true\n                return new Promise((resolve, reject) => {\n                    const reader = new FileReader()\n                    reader.onload = e => {\n                        const data = e.target.result\n                        const workbook = XLSX.read(data, { type: 'array' })\n                        const firstSheetName = workbook.SheetNames[0]\n                        const worksheet = workbook.Sheets[firstSheetName]\n                        const header = this.getHeaderRow(worksheet)\n                        const results = XLSX.utils.sheet_to_json(worksheet)\n                        this.generateData({ header, results })\n                        this.loading = false\n                        resolve()\n                    }\n                    reader.readAsArrayBuffer(rawFile)\n                })\n            },\n            getHeaderRow(sheet) {\n                const headers = []\n                const range = XLSX.utils.decode_range(sheet['!ref'])\n                let C\n                const R = range.s.r\n                /* start in the first row */\n                for (C = range.s.c; C <= range.e.c; ++C) { /* walk every column in the range */\n                    const cell = sheet[XLSX.utils.encode_cell({ c: C, r: R })]\n                    /* find the cell in the first row */\n                    let hdr = 'UNKNOWN ' + C // <-- replace with your desired default\n                    if (cell && cell.t) hdr = XLSX.utils.format_cell(cell)\n                    headers.push(hdr)\n                }\n                return headers\n            },\n            isExcel(file) {\n                return /\\.(xlsx|xls|csv)$/.test(file.name)\n            }\n        }\n    }\n</script>\n\n<style scoped>\n    .excel-upload-input{\n        display: none;\n        z-index: -9999;\n    }\n    .drop{\n        border: 2px solid #e9e8ed;\n        background: #fff;\n        width: 100%;\n        height: 200px;\n        line-height: 200px;\n        margin: 0 auto;\n        font-size: 28px;\n        border-radius: 10px;\n        text-align: center;\n        color: #bbb;\n        position: relative;\n    }\n</style>\n"]}]}